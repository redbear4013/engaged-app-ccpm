---
name: Priority 1 Source Adapters
status: open
created: 2025-10-01T01:34:04Z
updated: 2025-10-01T01:34:04Z
github: https://github.com/redbear4013/engaged-app-ccpm/issues/15
depends_on: [13, 14]
parallel: false
conflicts_with: []
---

# Task: Priority 1 Source Adapters

## Description

Implement source-specific adapters for the 6 Priority 1 event sources: MGTO (Macao Government Tourism Office), Broadway Macau, Galaxy Macau, Venetian Macau, Londoner Macau, and Timable Hong Kong. Each adapter maps source-specific HTML/JSON structures to our unified event schema and handles source-specific scraping logic.

## Acceptance Criteria

- [ ] Base adapter abstract class created with common interface
- [ ] MGTO adapter implemented with CSS selectors for event extraction
- [ ] Broadway Macau adapter handles calendar widget structure
- [ ] Galaxy Macau adapter processes event listings
- [ ] Venetian Macau adapter extracts show/event information
- [ ] Londoner Macau adapter maps entertainment events
- [ ] Timable Hong Kong adapter handles API/HTML hybrid structure
- [ ] Each adapter implements field mapping to unified schema
- [ ] Unit tests with mocked HTML responses for each adapter
- [ ] Integration tests verify end-to-end scraping workflow
- [ ] Error handling for malformed source data

## Technical Details

- **Implementation approach**:
  - Abstract base class `BaseAdapter` defines interface: `scrape()`, `parse()`, `transform()`
  - Each source adapter extends base class and implements source-specific logic
  - CSS selectors/XPath expressions stored in adapter configuration
  - Field mapping functions handle type conversions and normalization
  - Adapter registry pattern for dynamic source loading

- **Key considerations**:
  - Sources may change HTML structure without notice (brittleness risk)
  - Some sources use JavaScript rendering (Chrome DevTools MCP required)
  - Date/time parsing across different formats and timezones (HKT/CST)
  - Image URL extraction and handling relative paths
  - Pagination handling for sources with multi-page event lists
  - Rate limiting per source to avoid blocking
  - Detect when source structure changes (golden hash comparison)

- **Code locations/files affected**:
  - `src/adapters/base-adapter.ts`
  - `src/adapters/mgto-adapter.ts`
  - `src/adapters/broadway-adapter.ts`
  - `src/adapters/galaxy-adapter.ts`
  - `src/adapters/venetian-adapter.ts`
  - `src/adapters/londoner-adapter.ts`
  - `src/adapters/timable-adapter.ts`
  - `src/adapters/adapter-registry.ts`
  - `src/adapters/__tests__/mgto.test.ts` (and others)
  - `config/sources.json` (selector mappings)

## Dependencies

- [ ] Task 001: Orchestrator and tool selector available
- [ ] Task 002: Database schema for events storage
- [ ] Firecrawl MCP server configured
- [ ] Chrome DevTools MCP server configured
- [ ] Test fixtures with sample HTML from each source

## Effort Estimate

- Size: L
- Hours: 24-28
- Parallel: false

## Definition of Done

- [ ] All 6 adapters implemented and follow base interface
- [ ] Unit tests passing with >80% coverage
- [ ] Integration tests verify scraping against live sources (or recordings)
- [ ] Field mapping validated for all event attributes
- [ ] Error handling tested with malformed data
- [ ] Adapters registered in adapter registry
- [ ] CSS selectors documented and maintainable
- [ ] Date/time parsing handles all observed formats
- [ ] Image URLs correctly extracted and normalized
- [ ] Code reviewed and approved
- [ ] Deployed to staging environment
- [ ] Manual verification of scraped data quality
