---
name: Production Deployment & Documentation
status: backlog
created: 2025-10-01T01:34:04Z
updated: 2025-10-01T01:34:04Z
github: https://github.com/redbear4013/engaged-app-ccpm/issues/21
depends_on: [13, 14, 15, 16, 17, 18, 19, 20]
parallel: false
conflicts_with: []
---

# Task: Production Deployment & Documentation

## Description

Deploy the scraping pipeline to production environment via GitHub Actions, configure all required secrets (Supabase, Firecrawl, Slack), set up monitoring dashboard, and create comprehensive documentation including adapter development guide and troubleshooting runbook. This is the final deployment task before launch validation in Task 010.

## Acceptance Criteria

- [ ] GitHub Actions workflows deployed and scheduled
- [ ] All secrets configured in GitHub Secrets
- [ ] Monitoring dashboard deployed and accessible
- [ ] Adapter development guide complete
- [ ] Troubleshooting runbook complete
- [ ] Launch readiness checklist prepared
- [ ] Production environment validated
- [ ] Rollback plan documented

## Technical Details

### GitHub Actions Deployment

**Workflow Files**:

1. **Priority 1 Sources** (`.github/workflows/ingest-priority.yml`)
```yaml
name: Ingest Priority 1 Sources

on:
  schedule:
    - cron: "0 */2 * * *"  # Every 2 hours
  workflow_dispatch:  # Manual trigger

jobs:
  scrape:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Run scraping orchestrator
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
          FIRECRAWL_API_KEY: ${{ secrets.FIRECRAWL_API_KEY }}
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: node dist/scripts/ingest.js --config config/sources.json --priority 1

      - name: Upload logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: scraping-logs-priority1
          path: logs/
          retention-days: 7
```

2. **Priority 2-3 Sources** (`.github/workflows/ingest-standard.yml`)
```yaml
name: Ingest Priority 2-3 Sources

on:
  schedule:
    - cron: "0 */4 * * *"  # Every 4 hours
  workflow_dispatch:

# Similar structure to priority workflow
```

**Secrets Configuration** (GitHub Settings → Secrets):
- `SUPABASE_URL`: Supabase project URL
- `SUPABASE_SERVICE_KEY`: Service role key (for admin operations)
- `FIRECRAWL_API_KEY`: Firecrawl API authentication key
- `SLACK_WEBHOOK_URL`: Slack incoming webhook for alerts
- `SMTP_HOST`: Email server for critical alerts (optional)
- `SMTP_USER`: Email authentication username (optional)
- `SMTP_PASS`: Email authentication password (optional)

### Monitoring Dashboard Deployment

**Deployment Target**: Vercel or existing Next.js app

**Configuration**:
- Dashboard route: `/admin/scraping-monitor`
- Authentication: Admin role required (from Task 004)
- Real-time updates: Supabase realtime subscriptions
- Data retention: 30 days of run history

**Environment Variables**:
```env
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (server-side only)
```

### Documentation

#### 1. Adapter Development Guide

**File**: `docs/scraping/adapter-guide.md`

**Contents**:
- Overview of base adapter pattern
- Step-by-step guide to creating new adapter
- Selector mapping best practices
- Testing requirements
- Configuration schema reference
- Example adapter walkthrough
- Common pitfalls and solutions

**Structure**:
```markdown
# Event Source Adapter Development Guide

## Overview
The scraping system uses a configuration-driven adapter pattern...

## Creating a New Adapter

### 1. Create Adapter File
`src/adapters/my-source.ts`

### 2. Extend BaseAdapter
class MySourceAdapter extends BaseAdapter { ... }

### 3. Define Selectors
Define CSS selectors for event elements...

### 4. Implement extractEvent()
Extract fields from DOM elements...

### 5. Add Configuration
Update config/sources.json...

### 6. Write Tests
Create unit and integration tests...

## Testing Your Adapter
npm test -- adapters/my-source.test.ts

## Best Practices
- Use data attributes over classes when available
- Handle missing fields gracefully
- Normalize dates to UTC immediately
- Test with real HTML snapshots
```

#### 2. Troubleshooting Runbook

**File**: `docs/scraping/troubleshooting-runbook.md`

**Contents**:
- Common failure scenarios and solutions
- Circuit breaker recovery procedures
- Performance degradation diagnosis
- Alert triage guide
- Emergency rollback procedures
- Contact escalation matrix

**Structure**:
```markdown
# Scraping Pipeline Troubleshooting Runbook

## Alert Triage

### Critical: Zero Events from Priority 1 Source
**Symptoms**: Alert received, source shows 0 events scraped
**Diagnosis**:
1. Check source website for structure changes
2. Review scraping logs for errors
3. Validate selector mappings still work

**Resolution**:
1. If site changed: Update adapter selectors
2. If site down: Wait for recovery, circuit breaker will handle
3. If transient: Monitor next run

### Warning: Coverage Drop >30%
**Symptoms**: Field coverage dropped significantly
**Diagnosis**: Check which fields are missing...

## Circuit Breaker Recovery
...

## Performance Issues
...

## Emergency Contacts
- On-call developer: [contact info]
- Supabase support: [support link]
- Firecrawl status: https://status.firecrawl.dev
```

#### 3. Launch Readiness Checklist

**File**: `docs/scraping/launch-checklist.md`

**Contents**:
```markdown
# Launch Readiness Checklist

## Infrastructure
- [ ] GitHub Actions workflows scheduled and enabled
- [ ] All secrets configured and validated
- [ ] Supabase database accessible from GitHub Actions
- [ ] Monitoring dashboard deployed and accessible
- [ ] Slack webhook delivering test alerts

## Functionality
- [ ] All 15 sources configured in sources.json
- [ ] Priority 1 sources scraping successfully
- [ ] Priority 2-3 sources scraping successfully
- [ ] Deduplication working correctly
- [ ] Image optimization functional
- [ ] Revision tracking creating diffs

## Quality
- [ ] All tests passing (unit, integration, E2E)
- [ ] Code coverage >80%
- [ ] Performance benchmarks met
- [ ] Manual QA completed

## Monitoring
- [ ] Dashboard showing real-time metrics
- [ ] Alerts configured and tested
- [ ] Circuit breakers functional
- [ ] Logs accessible for debugging

## Documentation
- [ ] Adapter development guide complete
- [ ] Troubleshooting runbook complete
- [ ] Rollback procedures documented
- [ ] Team trained on alert response

## Approval
- [ ] Technical lead approval
- [ ] Product owner approval
- [ ] Stakeholder demo completed
```

### Rollback Plan

**Scenario**: Critical production failure requiring immediate rollback

**Procedure**:
1. **Disable GitHub Actions workflows**:
   - Navigate to Actions tab → Select workflow → Disable
   - Prevents scheduled runs while investigating

2. **Revert to previous stable version**:
   - Identify last working commit: `git log --oneline`
   - Create hotfix branch: `git checkout -b hotfix/rollback <commit-hash>`
   - Deploy via manual workflow trigger

3. **Notify stakeholders**:
   - Post to Slack: "Scraping pipeline rolled back due to [reason]"
   - Email critical stakeholders
   - Update status page if applicable

4. **Investigation**:
   - Review logs from failed runs
   - Identify root cause
   - Create fix in separate branch
   - Test thoroughly before re-deployment

## Dependencies

- [ ] Task 001: Core Infrastructure (orchestrator, workflows)
- [ ] Task 002: Database Schema (tables deployed)
- [ ] Task 003: Priority 1 Source Adapters
- [ ] Task 004: Data Pipeline
- [ ] Task 005: Image Optimization
- [ ] Task 006: Monitoring Dashboard
- [ ] Task 007: Priority 2-3 Source Adapters
- [ ] Task 008: Testing & QA (all tests passing)

## Effort Estimate

- Size: M
- Hours: 8-10 hours
- Parallel: false (final deployment task)

## Definition of Done

- [ ] GitHub Actions workflows deployed and scheduled
- [ ] Secrets configured and validated in GitHub Secrets
- [ ] Monitoring dashboard deployed to production
- [ ] Adapter development guide complete and reviewed
- [ ] Troubleshooting runbook complete and reviewed
- [ ] Launch readiness checklist prepared
- [ ] Rollback plan documented and validated
- [ ] Manual trigger tested for all sources via dashboard
- [ ] Logs accessible and searchable
- [ ] Alert delivery validated (Slack + email)
- [ ] Team trained on operational procedures
- [ ] Stakeholder approval received
