---
name: Replace getSession() in Server Code
status: open
created: 2025-10-05T15:25:19Z
updated: 2025-10-05T15:51:25Z
github: https://github.com/redbear4013/engaged-app-ccpm/issues/30
depends_on: []
parallel: true
conflicts_with: [24, 26]
---

# Task 007: Replace getSession() in Server Code

**Priority:** P2
**Effort:** M (6-10 hours)
**Parallel:** true (can run alongside other tasks)

## Description

Replace insecure getSession() with getUser() in all server-side code to follow Supabase security best practices.

## Acceptance Criteria

- [ ] Zero server-side getSession() usage remaining
- [ ] All API routes use getUser() for authentication
- [ ] Session validation works correctly
- [ ] No authentication warnings in server logs

## Technical Details

- Audit all files in `src/app/api/**/route.ts`
- Replace `getSession()` with `getUser()` in server-side code only
- Keep client-side getSession() unchanged (acceptable per Supabase docs)
- Update `src/lib/supabase/server.ts` if needed
- Test authentication flow end-to-end
- Files affected: All `src/app/api/**/route.ts`, `src/lib/supabase/server.ts`

## Dependencies

- **Depends on:** None
- **Conflicts with:** Tasks 001, 003 (modifies same API route files)

## Notes

Server-side getSession() is insecure because it doesn't verify the JWT signature. Using getUser() ensures proper authentication validation on the server.
